<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        *{
            padding: 0;
            margin: 0;
            list-style:none;
        }
        p{
            margin: 100px;
            width:300px;
        }
        #share_weibo{
            background-color: deepskyblue;
            width: 26px;
            height: 26px;
            position: absolute;
            display: none;
            background: url("images/a1.png");
        }
    </style>
</head>
<body>
    <p id="word">ufacviquweuiy8f
        7grqea
        jdsoipi9wefgrevuajcskao
        spwiedu8f9r
        fueqr78rfruijdkhbjfeew
        diokslchb
        gfitryewdklsmkchbvgyo8f
        7ew89dqr
        thyjukijuyhgtrfed78gyo
        vuhe
        bladjsakopweru89f8jd
        rgthy6uj7ik8ujyhgtrfer
        wgt
        hyuj7i68ujhyegtr
        i0oslalmdkcivgrfyuhedjq
        wedwf
        tghyujiuhytgrfe
        ujikujhygtrfder4g5y6u7
        ji87juy
    </p>
    <div id="share_weibo"></div>
    <script src="../js/my_func.js"></script>
    <script>
        //监听鼠标的抬起事件，只有当鼠标抬起的时候才完成了文字选择
        var selectedText;
        $("word").onmouseup=function(event){//鼠标抬起的时候被选中的文字开始被定位，此时用到的是clientX和clientY
            var e=event||window.event;//事件对象是鼠标事件
            if(window.getSelection){
                selectedText=window.getSelection().toString();
            }else{
                selectedText=document.selection.createRange().text();
            }
            if(selectedText!==''){
                //显示面板
                $("share_weibo").innerText=selectedText;
                $("share_weibo").style.display="block";
                //改变位置
                $("share_weibo").style.left=e.clientX+"px";//是鼠标此时的clientX和clientY
                $("share_weibo").style.top=e.clientY+"px";
                window.getSelection?window.getSelection().removeRanges:document.selection.empty();
            }
        }
        document.onmousedown=function(event){
            var e=window.event||event;
            var targetId=e.target?e.srcElement.id:e.target.id;
            if(targetId!=="share_weibo"){
                $("share_weibo").style.display="none";
                window.getSelection?window.getSelection().removeRanges:document.selection.empty();
            }else{
                //微博分享
                window.location.href="http://v.t.sina.com.cn/share/share.php?searchPic=false&title='+selectedText+'&url=https://github.com/xuanzhihua'";
            }
        }
    </script>
</body>
</html>